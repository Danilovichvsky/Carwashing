{% extends "WetCar/base.html" %}

{% block title %}Головна{% endblock %}

{% block content %}
<style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url("static/WetCar/images/v6_3.png") no-repeat center center fixed;
      background-size: cover;
      color: white;
  }
</style>
<!-- Форма бронирования -->
<div id="booking-form-section" class="booking-form">
    <h2>Забронюйте послугу</h2>
    <form action="{% url 'booking' %}" method="post" id="booking-form" onsubmit="showConfirmation(event)">
        {% csrf_token %}

        {% for field in form %}
        <div class="form-field {% if field.errors %}error{% endif %}">
            {{ field }}

            {% if field.errors %}
            <ul class="errorlist">
                {% for error in field.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endfor %}

        <button type="submit">Забронювати</button>
    </form>


</div>


<!-- The confirmation message -->
<div id="confirmation-message"
     style="display: none; color: white; text-align: center; font-size: 20px; background-color: rgba(0, 0, 0, 0.7); padding: 20px; border-radius: 10px;">
    Заказ сформирован, очікуйте на дзвінок!
</div>

<script>
    document.getElementById('booking-form').addEventListener('submit', async function (event) {
        event.preventDefault(); // Останавливаем стандартную отправку формы

        const form = event.target;
        const formData = new FormData(form);

        try {
            const response = await fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });

            if (response.ok) {
                const confirmationMessage = document.getElementById('confirmation-message');
                confirmationMessage.style.display = 'block'; // Показываем сообщение

                // Скрываем сообщение через 5 секунд
                setTimeout(() => {
                    confirmationMessage.style.display = 'none';
                }, 5000);

                // Очищаем форму (опционально)
                form.reset();
            } else {
                const errors = await response.json();
                displayErrors(errors); // Показываем ошибки (опционально)
            }
        } catch (error) {
            console.error('Ошибка при отправке формы:', error);
        }
    });

    function displayErrors(errors) {
    // Очищаем существующие ошибки
    document.querySelectorAll('.errorlist').forEach((errorList) => errorList.remove());

    // Проходим по всем полям формы
    for (const [fieldName, fieldErrors] of Object.entries(errors)) {
        const field = document.querySelector(`[name="${fieldName}"]`);
        if (field) {
            // Находим контейнер для текущего поля
            const fieldContainer = field.closest('.form-field');

            // Создаем список ошибок
            const errorList = document.createElement('ul');
            errorList.className = 'errorlist';

            // Добавляем ошибки в список
            fieldErrors.forEach((error) => {
                const errorItem = document.createElement('li');
                errorItem.textContent = error;
                errorList.appendChild(errorItem);
            });

            // Вставляем ошибки после поля
            fieldContainer.appendChild(errorList);
        }
    }
}

</script>




{% if form %}
<p>Форма отображается правильно</p>
{% else %}
<p>Форма не передана или есть проблема с рендерингом.</p>
{% endif %}

{% endblock %}